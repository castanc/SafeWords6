<!DOCTYPE html>
<html Lang="en">

<head>
    <meta charset-"UTF-8">
    <meta name="viewport" content="width-device-width, initial-scale-1.0">
    <title>Sección de tarjetas responsive</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    
    
    

    
    
    
    
    
    
    
<style>.card,.card-small{background-color:#58b19f;border-radius:.75rem}.card .card-body p,body{margin:0}.hidden{display:none}.visible{display:block}.field-size{font-size:2em}.size-header,label{font-size:1.5em}.centered{text-align:center}.icon-eye{margin-left:-30px;cursor:pointer}body{padding:0;background-color:#000;color:#fafbff;font-family:Avenir Next,Avenir,SegoeUI,sans-serif;min-height:50vh;display:flex;align-items:center}.container-cards{padding-left:2rem;padding-right:2rem}.card-section{display:grid;gap:1.75rem;grid-template-columns:repeat(auto-fill,minmax(288px,1fr))}.card{padding:1.75rem;display:flex;flex-wrap:wrap}.card-section-small{display:grid;gap:1.75rem;grid-template-columns:repeat(auto-fill,minmax(60px,1fr))}.card-small{padding:.5rem;display:flex;flex-wrap:wrap}.card .card-header{flex-basis:100%;font-size:1.5rem;text-transform:uppercase}.card .card-body{flex-basis:100%;margin-top:1.2rem}.icon-big{font-size:14em}.icon-medium{font-size:3em;padding:.2em}.card .card-body a{text-decoration:none;color:#fafbff;display:inline-block;padding:.7rem 1.75rem;border:1px solid transparent;background-color:w171f;border-radius:1.75rem;margin-top:1.2ren}.card .card-body a:hover{background-color:transparent;border-color:#0e171f;color:e171f}.card .card.footer{flex-basis:100%;align-self:flex-end;text-align:end;font-size:0.Brem}label{padding-bottom:1em}input,textarea{font-size:2em;width:100%}</style>
<script id='nomin'>//JS START ./main.js
function doAction(id) {
    alert(id);
}

function showMainText()
{
    hideControl("mainMenu");
    showControl("enterText");
    infoMessage("Enter text to Encrypt");
}

function goMainText(id)
{
    hideControl(id);
    showControl("enterText");
}

function goAdvanced(id)
{
    hideControl(id);
    showControl("advanced");
}
function goPasswords(id)
{
    hideControl(id);
    showControl("enterPasswords");
}

function goHome(id)
{
    hideControl(id);
    showControl("mainMenu")
    // updateClass(id,"visible","hidden");
    // updateClass("mainMenu","hidden","visible");
}

function goFinalPage(id)
{
    hideControl(id);
    showControl("finalPage");
    
}

function goSavePage(id)
{
    hideControl(id);
    showControl("savePage")
}

function selectPaste() {
    pasteClipboard();

}

function doEncrypt2()
{

}

function doDecrypt2(){
    
}

function showSystemInfo(id)
{
    hideControl(id);
    showControl("divSysInfo");
}





//JS END ./main.js

//JS START ../common6/utils.js
function writeInnerHTML(divId, html) {
	let ctl = document.getElementById(divId);
	if (ctl)
		ctl.innerHTML = html;
	else
		console.error("writeInnerHTMKL() ERROR:",divId);
}


function testIcons(){

	let icons = [];
	icons.push(`<i class="fas fa-backspace"></i>`);
	icons.push(`<i class="material-icons">backspace</i>`);

	let html = "";
	icons.forEach(x=>{
		html += x;
	})

	writeInnerHTML("testIcons", html);
}

function writeInnerText(divId, text) {
	let ctl = document.getElementById(divId);
	if (ctl)
		ctl.innerText = text;
	else
		console.error("writeInnerText() ERROR:",divId);
}

function clickButton(id)
{
	console.log("clickButton " + id);
	let btn = document.getElementById(id);
	if ( btn)
		btn.click();
}

function extract(text, start, end = "") {
	let word = "";
	try {
		let index = text.indexOf(start);
		let index2 = 0;
		while (index >= 0) {
			index += start.length;
			if (end.length > 0)
				index2 = text.indexOf(end, index);
			else index2 = text.length;

			if (index2 > index) {
				word = text.substr(index, index2 - index);
			}
			index = text.indexOf(start, index2 + end.length);
		}
	}
	catch (ex) {
		//return GSLog.handleException(ex, "Utils.replace()");
		//return text;
	}
	return word;
}

function setLabel(lblId, visible) {
	if (visible)
		showBlock(lblId);
	else
		hideControl(lblId);
}


function shareData(title, text, url) {
	if (navigator.share) {
		showMessage(translate("Sharing")+"...");

		if (shareFile != null) {
			console.log("sharingFile", shareFile);
			showMessage(translate("Sharing File") + "...");
			navigator.share({
				title: title,
				file: shareFile,
				url: url,
			})
				.then(() => showMessage(translate("Shared succesfully."), statusSuccess))
				.catch((error) => {

					showError("Error sharing:" + error);
				});

		}
		else {
			console.log("sharing TEXT");
			showMessage(translate("Sharing text..."));
			navigator.share({
				title: title,
				text: text,
				url: url,
			})
				.then(() => showMessage(translate("Shared succesfully."), statusSuccess))
				.catch((error) => {

					showError("Error sharing:" + error);
				});
		}
		canShare = false;
	}
	else {
		showError("Share not supported, use manual paste.");
		canShare = false;
	}

}


function verifyLabel(fieldId, lblId) {
	let value = getField(fieldId);
	let visible = value.length > 0;
	if (visible)
		showBlock(lblId);
	else
		hideControl(lblId);
}


function showSelected(itemId) {
	let anchor = document.getElementById(`A_${lastSelected}`);
	if (anchor != null)
		anchor.className = "";


	anchor = document.getElementById(`A_${value}`);
	if (anchor != null)
		anchor.className = "active";

	anchor = document.getElementById("A_dynSelect");
	if (anchor != null)
		anchor.click();

}


function setFocus(ctlId) {
	let x = document.getElementById(ctlId);
	if (x)
		x.focus();
}

function selectMenu(menuId) {
	newMenu = false;

	let menu2 = menus.filter(x => x.Id == menuId);
	if (menu2.length > 0)
		menu = menu2[0];
	else {
		menu = {};
		menu["Id"] = menuId;
		menu["currentIndex"] = 0;
		menu["currentText"] = "";
		menu["enumerator"] = "";
		menu["Options"] = [];
		newMenu = true;
	}

	return newMenu;
}

function buildMenuButtons(menuId, actions) {

	let html = "";
	let count = 0;
	let active = "";
	selectMenu(menuId);
	if (actions.length > 0) {
		menu.currentText = actions[0].caption;
		menu.currentIndex = 0;
	}

	actions.forEach(ac => {
		if (!ac.className)
			ac.className = "";

		if (!ac.pars || ac.pars.length == 0)
			ac.pars = `'${menuId}','${ac.id}',${count}`;
		else
			ac.pars = `'${menuId}','${ac.id}',${count},${ac.pars}`;

		if (!ac.kind)
			ac.kind = "";

		if (!ac.separator)
			ac.separator = "";


		ac["Index"] = count;
		count++;


		html = `${html}<button id="${ac.id}" type="button" class="btn ${ac.className} separation-btn" onclick="${ac.method}(${ac.pars})">${ac.caption}</button>${ac.separator}`;
	});

	let m = document.getElementById(menuId);
	m.innerHTML = html;

	menu["Options"] = actions;
	menu["currentText"] = section;
	if (newMenu) {
		menus.push(menu);
		console.log("newMenu:", menus);
	}
	showBlock(menuId);
}


function buildMenu(menuId, section, actions, icon, currentSelected = "") {

	selectMenu(menuId);
	menu.currentText = "";
	menu.currentIndex = 0;
	let html = "";
	let active = "";
	let firstOption = "";
	let count = 0;
	actions.forEach((ac) => {
		if (!ac.className)
			ac.className = "";

		if (!ac.pars || ac.pars.length == 0)
			ac.pars = `'${menuId}','${ac.id}',${count}`;
		else
			ac.pars = `'${menuId}','${ac.id}',${count},${ac.pars}`;

		if (!ac.kind)
			ac.kind = "";


		ac["Index"] = count;

		if (currentSelected.length > 0 && ac.caption == currentSelected) {
			active = "active";
			menu.currentText = ac.caption;
			menu.currentText = count;
		}
		else active = "";

		count++;

		html = html + `<a id="${ac.id}" class="${ac.className} ${active}"  href="javascript:void(0);" onclick="${ac.method}(${ac.pars})">${ac.caption}</a>`;
	});

	menu["Options"] = actions;
	if (menu.currentText == "") {
		menu.currentText = menu.Options[0].caption[0];
		menu.currentIndex = 0;
	}

	firstOption = `<a id="A_${menuId}" href="javascript:void(0);" onclick="selectNext('${menuId}')" class="responsive active">${currentSelected}</a>`;

	html = firstOption + html + ` <a id="A_${menuId}" href="javascript:void(0);" class="icon" onclick="changeMenuClass('${menuId}')">
	<i class="${icon}"></i>`;

	let m = document.getElementById(menuId);
	if (m)
		m.innerHTML = html;


	if (newMenu) {
		menus.push(menu);
	}
	showBlock(menuId);
}

function buildMenuWithButtons(menuId, section, actions, icon, currentSelected = "") {

	selectMenu(menuId);
	menu.currentText = "";
	menu.currentIndex = 0;
	let html = "";
	let active = "";
	let firstOption = "";
	let count = 0;
	actions.forEach((ac) => {
		if (!ac.className)
			ac.className = "";

		if (!ac.pars || ac.pars.length == 0)
			ac.pars = `'${menuId}','${ac.id}',${count}`;
		else
			ac.pars = `'${menuId}','${ac.id}',${count},${ac.pars}`;

		if (!ac.kind)
			ac.kind = "";


		ac["Index"] = count;

		if (currentSelected.length > 0 && ac.caption == currentSelected) {
			active = "active";
			menu.currentText = ac.caption;
			menu.currentText = count;
		}
		else active = "";

		count++;

		html = html + `<button type="button" class="btn btn-primary button-separation form-control" id="${ac.id}" onclick="${ac.method}(${ac.pars})">${ac.caption}</button>`;
	});

	menu["Options"] = actions;
	if (menu.currentText == "") {
		menu.currentText = menu.Options[0].caption[0];
		menu.currentIndex = 0;
	}

	/*
	firstOption = `<a id="A_${menuId}" href="javascript:void(0);" onclick="selectNext('${menuId}')" class="responsive active">${menu.currentSelected}</a>`;

	html = firstOption + html + ` <a id="A_${menuId}" href="javascript:void(0);" class="icon" onclick="changeMenuClass('${menuId}')">
	<i class="${icon}"></i>`;
	*/

	let m = document.getElementById(menuId);
	if (m)
		m.innerHTML = html;


	if (newMenu) {
		menus.push(menu);
	}
	showBlock(menuId);
}


function updateSelectedNav(menuId, text) {
	let x = document.getElementById(`A_${menuId}`);
	if (x) {
		let k2 = Keys.filter(x => !x.Key.includes("Parameter_") && x.Key.toUpperCase().includes(currentKey.toUpperCase()));
		if (k2.length > 0) {
			x.innerText = k2[0].Key;
			x.className = "active";
		}
	}
}

function updateSelectedNav2(menuId, text) {
	let x = document.getElementById(`A_${menuId}`);
	if (x) {
		let k2 = Keys.filter(x => !x.Key.includes("Parameter_") && x.Key.toUpperCase().includes(currentKey.toUpperCase()));
		if (k2.length > 0) {
			currentKey = k2[0].Key;
			showMessage(`Key ${currentKey} is selected`);
			x.innerText = k2[0].Key;
			x.className = "active";
		}
	}
}




function buildHeader(menuId, section, childDiv, icon, method = "changeMenuClass2") {

	let html = "";
	title = title.replace(" ", "");
	//onclick="enableSection2('${childDiv}')
	if (section.length > 0)
		html = `<a id="A_FIRST" href="javascript:void(0);" class="active">${section}</a>`;

	html = html + ` <a id="A_${menuId}" href="javascript:void(0);" class="icon" onclick="${method}('${menuId}','${childDiv}')">
	<i class="${icon}"></i>`;

	let m = document.getElementById(menuId);
	m.innerHTML = html;
	showBlock(menuId);
	menu["Options"] = options;

	console.log("menu", menu);
}


function setField(fieldId, value) {
	let ctl = document.getElementById(fieldId);
	if (ctl)
		ctl.value = value;
	else showError(`setField(${fieldId}) invalid field`);
}


function setInnerText(divId, text) {
	let ctl = document.getElementById(divId);
	if (ctl)
		ctl.innerText = text;
	else console.error(`Can't find control ${divId}`);
}

function setTextArea(fieldId, value) {
	let ctl = document.getElementById(fieldId);
	if (ctl)
		ctl.innerText = value;
	else showError(`setField(${fieldId}) invalid field`);
}


function getField(fieldId) {
	let ctl = document.getElementById(fieldId);
	if (ctl)
		return ctl.value;

	return "";
}




function setValue(formName, fieldId, value) {
	try {
		var x = document.forms[formName][fieldId];
		if (x != undefined) {
			x.value = value;
		}
		else {
			console.error(`setValue() ${formName},${fieldId}, ${value}`, frm);
			addTrace(`Error ins etValue(): ${formName} ${fieldId} ${value}`);
		}
	}
	catch (ex) {
		console.error(`setValue() EXCEPTION ${formName},${fieldId}, ${value}, ${ex}`);
		addTrace(`EXCEPTION in setValue(): ${formName} ${fieldId} ${value} ${ex.message}`);
	}
}

function removeElement(divId) {
	let div = document.getElementById(divId);
	if (div)
		div.remove();
	//else console.log(`removeElemnt() Error removing ${divId}`)
}


function resetClass(ctlId, className) {
	let x = document.getElementById(ctlId);
	if (x)
		x.className = className;
}

function setClass(elemName, oldClass, newClass) {
	if (document.getElementById(elemName).classList.contains(oldClass))
		document.getElementById(elemName).classList.remove(oldClass);

	document.getElementById(elemName).classList.add(newClass);

}

function getChecked(controlName) {

	let result = false;
	let control = document.getElementById(controlName);
	result = (control && control.checked);
	return result;
}

function setChecked(controlName,value=true) {

	let control = document.getElementById(controlName);
	if ( control )
		control.checked = value;
	
}


//https://stackoverflow.com/questions/24424214/disable-copy-or-paste-action-for-text-box/24424280
function banKeyboardActions(controlName, restrictions) {
	return;
	//cut copy paste
	let control = document.getElementById(controlName);
	if (control) {
		try {
			control.bind(restrictions, function (e) {
				e.preventDefault();
			});
		}
		catch (ex) {
			console.log("banKeyboardActions() EXCEPTION", ex);
		}
	}
}


//THIS CLOSES THE NAV BAR
function changeMenuClass(menuId) {

	let x = document.getElementById(menuId);
	if (x) {
		if (x.className === "topnav") {
			x.className += " responsive";
		} else {
			x.className = "topnav";
		}
	}

}


//https://stackoverflow.com/questions/1349404/generate-random-string-characters-in-javascript
//not use chars used in file names, json, csv
function makeid(length) {
	var result = '';
	//var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+{}[]-=~`<>,./?><":;' + "'";
	var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%()_+-=~.';
	var charactersLength = characters.length;
	for (var i = 0; i < length; i++) {
		result += characters.charAt(Math.floor(Math.random() *
			charactersLength));
	}
	return result;
}


function makeUserId(length) {
	var result = '';
	var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
	var charactersLength = characters.length;
	for (var i = 0; i < length; i++) {
		result += characters.charAt(Math.floor(Math.random() *
			charactersLength));
	}
	return result;
}


function meetPasswordRules(value) {
	let upperCase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
	let lowerCawe = 'abcdefghijklmnopqrstuvwxyz';
	let digits = "0123456789";
	let symbols = '!@#$%^&*()_+{}[]-=~`<>,./?><":;' + "'";
	let result = false;

	return result;
}



function makeidUpperCase(length) {
	let result = '';
	let characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
	let charactersLength = characters.length;
	for (var i = 0; i < length; i++) {
		result += characters.charAt(Math.floor(Math.random() *
			charactersLength));
	}
	return result;
}

function makeidLowerCase(length) {
	let result = '';
	let characters = 'abcdefghijklmnopqrstuvwxyz';
	let charactersLength = characters.length;
	for (var i = 0; i < length; i++) {
		result += characters.charAt(Math.floor(Math.random() *
			charactersLength));
	}
	return result;
}
function makeidDigits(length) {
	let result = '';
	let characters = '0123456789';
	let charactersLength = characters.length;
	for (var i = 0; i < length; i++) {
		result += characters.charAt(Math.floor(Math.random() *
			charactersLength));
	}
	return result;
}

function makeidSymbol(length) {
	let result = '';
	let characters = '!@#$%^&*()_+{}[]-=~`<>,./?><":;' + "'";
	let charactersLength = characters.length;
	for (var i = 0; i < length; i++) {
		result += characters.charAt(Math.floor(Math.random() *
			charactersLength));
	}
	return result;
}




function getValue(formName, fieldId) {
	let x = document.forms[formName][fieldId];
	if (x == undefined)
		return "";
	else return x.value;
}



function showDiv(divId, value) {
	let div = document.getElementById(divId);
	if (div != undefined) {
		if (value)
			div.style.display = "block";
		else
			div.style.display = "none";
	}
	//else console.log(`div ${divId} not found`);
}

function forceDark() {
	let inputs = document.querySelectorAll('input');
	inputs.forEach(inp => {
		inp.classList.add("forceDarki");
	})

	let textareas = document.querySelectorAll('textarea');
	textareas.forEach(ta => {
		ta.classList.add("forceDark");
	})
}

function disableButtons(state) {
	const buttons = document.querySelectorAll('button');
	for (var i = 0; i < buttons.length; i++) {
		buttons[i].disabled = state;
	};

}

function disableCtl(ctlName, state = false, bg = "black", tx = "white") {
	let ctl = document.getElementById(ctlName);
	if (ctl) {
		ctl.disabled = state;
		if (!state) {
			ctl.style.backgroundColor = bg;
			ctl.style.color = tx;
		}
	}

}


async function readJson (url) {
	fetch(url)
	.then(response => {
		if (!response.ok) {
			throw new Error("HTTP error " + response.status);
		}
		let data = response.json();
		return data;
	})
	.then(json => {
		return json;
	})
	.catch(function () {
		this.dataError = true;
	})
 }

function enableCtl(ctlName, state = true) {
	let ctl = document.getElementById(ctlName);
	ctl.disabled = !state;

}


function showMessageAt(divId, msg, status = "") {
	let div = document.getElementById(divId);
	if (div) {
		if (msg.length > 0)
			div.innerHTML = `<div class="alert alert-success">
		<strong>${status}</strong> ${msg}
	</div>
	`;
		else
			div.innerHTML = "";
	}

}

function showMessageTranslate(msg, title = "") {
	if (title.length == 0)
		title = statusSuccess;
	msg = translate(msg);
	let div = document.getElementById("result");
	if (msg.length > 0)
		div.innerHTML = `<div class="alert alert-success message-size">
		<strong>${title}</strong> ${msg}
	</div>
	`;
	else
		div.innerHTML = "";
}



function showMessage(msg, title = "") {
	if (title.length == 0)
		title = statusSuccess;
	let div = document.getElementById("result");
	if (msg.length > 0)
		div.innerHTML = `<div class="alert alert-success message-size">
		<strong>${title}</strong> ${msg}
	</div>
	`;
	else
		div.innerHTML = "";
}


function showMessage2(msg, divName = "result", title = "statusSuccess") {
		
	let div = document.getElementById(divName);
	if (msg.length > 0)
		div.innerHTML = `<div class="alert alert-success message-size">
		<strong>${title}</strong> ${msg}
	</div>
	`;
	else
		div.innerHTML = "";
}


function showInfo(msg, title = "") {
	if (title.length == 0)
		title = `<i class="fas fa-info-circle"></i>`;
	let div = document.getElementById("result");
	if (msg.length > 0)
	{
		msg = translate(msg);
		div.innerHTML = `<div class="alert alert-info field-size">
		<strong>${title}</strong> ${msg}
	</div>
	`;
	}
	else
		div.innerHTML = "";


}


function showInfoAt(divId, msg, title = "") {
	if (title.length == 0)
		title = `<i class="fas fa-info-circle"></i>`;
	let div = document.getElementById(divId);
	if (div) {
		if (msg.length > 0)
		{
			msg = translate(msg);
			div.innerHTML = `<div class="icon-size alert alert-info field-size">
		<strong>${title}</strong> ${msg}
	</div>
	`;
		}
		else
			div.innerHTML = "";
	}
	else console.error(`Invalid div ${divId}`);


}


function showError(msg) {
	lastError = msg;
	if (msg.length > 0)
		console.error("ERROR:", msg);

	let div = document.getElementById("result");
	//div.innerHTML = `<h4 class="text-danger text-center footer-size">${msg}</h4`;
	div.innerHTML = `<div class="alert alert-danger field-size">
	<strong>${statusError}</strong> ${msg}
  </div>`;
}

function debugMessage(msg) {
	console.log("debugMessage()", showDebug, msg);
	if (showDebug) {
		let div = document.getElementById("debug");
		if (div)
			div.innerHTML = `<h3 class="text-warning  text-center ">${msg}</h3`;
	}

}


function showWarning(msg, title = "", divId = "result") {
	if ( title.length == 0 )
		title = statusWarning;
	let div = document.getElementById(divId);
	//div.innerHTML = `<h4 class="text-warning text-center footer-size">${msg}</h4`;
	div.innerHTML = `<div class="alert alert-warning">
	<strong>${title}</strong>${msg}
  </div>`;
}


function showMessageIn(divName, msg) {
	let div = document.getElementById(divName);
	if (div)
		div.innerHTML = `<h3 class="row text-info">${msg}</h3>`;
	else
		showError(`Invalid div: [${divName}]`)
	if (msg.length > 0)
		showBlock(divName);
	else
		hideControl(divName);

}

async function readTextFile() {

	try {
		fileHandle = await window.showOpenFilePicker();
		const file = await fileHandle[0].getFile();
		data = await file.text();
	}
	catch (ex) {
		console.error("readTextFile() EXCEPTION", ex);
		data = "";
	}

	return data;


}



function setText(ctlId, text) {
	let control = document.getElementById(ctlId);
	if (control)
		control.innerText = text;
	else console.error("setText() error:", ctlId, text);
}



function saveBlobToDisk(fileName, dataBlob) {
	//    selectNavOption(btnId);
	showError("");

	if (supported && location.protocol == "https:" && !fileHandle) {
		fileHandle = getNewTextFileHandle();
	}

	globalResult = false;
	let anchor = downloadBlob(dataBlob, fileName);

	if (anchor != null) {
		globalResult = false;
		result = false;
		anchor.click();
	}

	if (globalResult)
		showMessage(translate("The data was saved succesfully"));
	else
		showMessage(translate("The data was saved to your Downloads folder"));
}


function textToBlob(text) {

	let myblob = new Blob([text], {
		type: 'text/plain'
	});
	return myblob;
}



async function openImageFile() {
	clear(false);
	//Keyboard.close();
	hideControl("divHelp");
	showMessage("");
	hideControl("divInfo");
	hideControl("divSetttings");
	hideControl("divView");
	hideControl("divHide");
	hideTitle();
	initialIcons = false;

	if (settingsOpen)
		toggleSettings();

	if (sysInfoOpen)
		toggleSysInfo();

	hideControl("bigFile");
	//hideControl("divInputText");
	fileMode = "Binary";
	manualText = false;
	data = "";


	// let fctl = document.getElementById("files");
	// fctl.click();
	// return;


	//TODO: oldschool way, fileAPI not supported in iframe
	//ONCLICK IS NULL 2ND TIME
	readBase64 = true;
	let fctl = document.getElementById("files");
	fctl.click();
	//todo: new check if required
	if ( encryptedFile)
		gotoPage(2);
	return;

	// if (supported) {
	// 	await openImageFileAPI().then(result => {
	// 		//showData();
	// 	})
	// }
	// else {
	// 	readBase64 = true;
	// 	let fctl = document.getElementById("files");
	// 	fctl.click();
	// }
}





//pdf messages
function handleMessage(msg) {
	alert('got message ' + msg);
}
function setupHandler() {
	document.getElementById("myPdf").messageHandler = { onMessage: handleMessage };
}

function getSizeText(len) {
	let val = len;
	let legend = "bytes.";
	let msg = "";
	if (val > 1024 && val < 1024 * 1024) {
		val = Math.round(val / 1024);
		legend = "KB.";
	}
	else if (val > 1024 * 1024) {
		legend = "MB.";
		val = Math.round(val) / (1024 * 1024);
	}
	let txt = val.toString();
	let ix = txt.indexOf(".");
	if (ix >= 0 && txt.length > ix + 2)
		txt = txt.substr(0, ix + 2);
	msg = `${txt} ${legend}`;
	return msg;
}

function isEncryptedData() {
	encryptedFile = data.includes(softwareID) || (data.includes("data:") && data.includes(`data2:`) && data.includes(`data3:`));
	if (!encryptedFile)
		encryptedFile = data.includes(softwareID) || (data.includes(`"data":`) && data.includes(`"data2":`) && data.includes(`"data3":`));

	return encryptedFile;
}



function autoClickLink(url)
{
	let a = document.createElement("a");
	a.href = url;;
	a.click();

}

function getIsDesktop() {
	return !mobile;
}


function getIsGoogleVer() {
	isGoogleVer = window.location.href.includes("script.google.com") && location.protocol == "https:"
	return isGoogleVer;
}

function confirmDownload() {

	if ( !fileName)
		fileName = "download";
	gotoPage(4);
	hideControl("divDownload");
	hideControl("divFileInfo");
	hideControl("divPaste");
	hideControl("divOpenFile");
	showControl("divDownload2");
	setField("txFileName", fileName);
	setCurrentField("txFileName");
	//showMenu();
	addMessageT("Confirm Download/Save!. File will be unencrypted. Dispose properly.",statusDanger,classDanger);
	renderMessages();
}

function doDownload() {
	clearMessages();
	let fn = getField("txFileName");
	if (fn.length > 0) {
		if (encryptionDone) {
			fn = fn.toLowerCase().replace(ext2, "");
			if (!fn.toLowerCase().includes(ext1))
				fn = fn + ext1;
			fn = fn + ext2;
		}
		fileName = fn;
	}

	hideControl("PAGE4");
	if (data.length > 0) {
		//downloadDataFile(data, fileName);
		//todo: not downloading text files
		if (usingFile) {
			if (selFile.type.includes("pdf"))
				downloadFile();
			else (selFile.type.includes("text"))
			downloadDataFile(data, fileName);
		}
		else {
			downloadDataFile(data, fileName);
		}

		hideControl("divDownload");
		showMessage(`${saveIcon} ${translate("OK. Saved to Downloads folder")}`);
	}
	else showError("No data to download.");
}


async function testRemote() {
	let url = "https://drive.google.com/file/d/1DtZwzILQNZwKH-e-kHJ5_pucflS-Anac/view?usp=sharing";
	//await openRemote("https://drive.google.com/file/d/1DtZwzILQNZwKH-e-kHJ5_pucflS-Anac/view?usp=sharing");
	try {
		// GET request
		const response = await fetch(url, {
			method: 'GET',
			mode: 'no-cors'
		})

		if (response.status === 200) {
			const data = await response.json();
			this.listApp = data;
			this.listApp.forEach(app => {
				if (app.status === "DISCONNECTED") {
					this.listDecApp.push(app);
				}
			});
			this.nbr = this.listDecApp.length;
		} else {
			if (response.status === 400) this.errors = ['Invalid app_permissions value. (err.400)'];
			if (response.status === 401) this.errors = ['Acces denied. (err.401)'];
		}
	} catch (error) {
		console.log(error);
		this.errors = ["Une erreur est survenue lors de la récupération des informations sur le serveur."]
	}

}



function getFileInstructions() {
	let instructions = "";
	if (usingFile)
		instructions = `
Instructions:
2. Locate file with extension Crypti.txt
1. Go to Link
2. Open file
3. Enter Password.
4. Decrypt.

Link: ${landingLink}\n`;


	return instructions;

}


function getInstructions() {
	let instructions = "";
	if (config.SendInstructions)
		if (usingFile)
			instructions = `
Instructions:
1. Go to Link
2. Open this file
3. Enter Password.
4. Decrypt.\n`;
		else
			instructions = `
Instructions:
1. Copy Message in Source
2. Go to Link
3. Paste Message
4. Enter Password
5. Decrypt.\n`;


	return instructions;

}



async function openRemote(url) {
	fetch(url)
		.then((response) => {
			return response.json();
		})
		.then((data) => {
			let authors = data;

			authors.map(function (author) {

			});
		})
}


function showSpinner(value = true, msg = "Loading...") {
	if (value) {
		hideControl("main");
		showInfo(msg);
		showBlock("spinner");
	}
	else {
		showBlock("main");
		hideControl("spinner");
		showMessage("");
	}
}







function handleError(msg) {
	showError(msg);
	if (page == 2)
		nextPage();
}







async function openFile(divId) {
	gotoPage(1);
	data = "";
	setField("inputText", "");
	fileMode = "Text";
	readBase64 = false;
	if (supported) {
		await openTextFileAPI2().then(result => {
			// showData();
			// nextPage();
		})
	}
	else
		showBlock(divId);
}


async function openEncryptedFile(divId) {
	if (supported) {
		await openTextEncryptedFileAPI2().then(result => {
			showData();
		})
	}
	else
		showBlock(divId);
}


//todo: to test with different icons in the same page
function toggleIcon(statusVar, ctlId, originalStateClass = "fa-eye", toggleClass = "fa-eye-slash") {
	//fa-eye-slash}
	statusVar = !statusVar
	const ctl = document.getElementById(ctlId);

	ctl.addEventListener('click', function (e) {
		// toggle the type attribute
		if (statusVar)
			this.classList.toggle(originalStateClass);
		else
			this.classList.toggle(toggleClass);
	});
}

async function openTextFile(divId) {
	fileMode = "Text";
	if (supported) {
		await openTextFileAPI().then(result => {
			showData();
			hideControl("fileSelection");
		})
	}
	else
		showBlock(divId);
}


//this only works under https

function openBinFile(fieldId) {
	var input = document.getElementById(fieldId).files;
	var fileData = new Blob([input[0]]);

	var reader = new FileReader();
	reader.readAsArrayBuffer(fileData);
	reader.onload = function () {
		let arrayBuffer = reader.result
		let bytes = new Uint8Array(arrayBuffer);
		return bytes;
	}
	return [];
}

async function getNewTextFileHandle(ext = ".txt") {

	if (!supported)
		return null;

	const options = {
		types: [
			{
				description: 'Text Files',
				accept: {
					'text/plain': [ext],
				},
			},
		],
	};
	const handle = await window.showSaveFilePicker(options);
	return handle;
}

function doToast(divId, action) {
	let div = document.getElementById(divId);
	if (div)
		div.toast(action);
}

function copyToClipboardNew(message, showMsg = false) {
	navigator.clipboard.writeText(message)
		.then(() => {
			canCopy = true;
			// if (showMessage)
			// 	showMessage(`Text copied to clipboard. (${message.length} bytes.)`);
		})
		.catch(err => {
			canCopy = false;
			showError("Error copying to clipboard. " + err);
			// This can happen if the user denies clipboard permissions:
			console.error("Can not copy clipboard via AP", err);
		});
	return canCopy;
}

function saveTextToFile(fileName, data) {
	//var blob = new Blob([data], { type: "text/plain;charset=utf-8" });
	let blob = new Blob([data], { type: "text/plain;charset=utf-8" });

	try {
	}
	catch (ex) {
		console.error("Exception saving to file", ex);
		console.log("copied to clipboard");
		copyToClipboardNew(data);
		showError("Can not save to a local file. Data copied to clipboard, save it manually");

	}

}

function showResultMessage(r) {
	if (r.result >= 0) {
		showMessage(r.message);
	}
	else
		showError(r.message);
}


function showErrorIn(divName, msg) {
	let div = document.getElementById(divName);
	if (div)
		div.innerHTML = `<h6 class="row text-danger">${msg}</h6`;
	else
		showError(`Invalid div: [${divName}]`)

	if (msg.length > 0)
		showBlock(divName);
	else
		hideControl(divName);

}


function showLog(text) {
	showInDiv("logs", text);
}


function getCurrentText(btn) {
	let currentText = document.querySelector(`#${btn}`).innerHTML;
	return currentText;
}

function setCurrentText(btn, text) {
	document.querySelector(`#${btn}`).innerHTML = text;
}

function copyToClipboardOld(fieldId) {
	var copyText = document.getElementById(fieldId);
	if (copyText) {
		copyText.select();
		document.execCommand("copy");
	}
}

function copyToClipboardInField(formName, fieldId, value) {
	setValue(formName, fieldId, value);
	var copyText = document.getElementById(fieldId);
	if (copyText) {
		copyText.select();
		document.execCommand("copy");
	}
	setValue(formName, fieldId, "");
}


function copyToClipboard(formName, text, id = "") {

	if (id.length > 0) {
		var copyText = document.getElementById(id);
		copyText.select();
		document.execCommand("copy");
		setValue(formName, id, "");
	}
	else {
		navigator.clipboard.writeText(text)
			.then(() => {
				canCopy = true;
			})
			.catch(err => {
				canCopy = false;
				// This can happen if the user denies clipboard permissions:
				console.error("Can not copy clipboard via AP", err);
			});
	}
	return canCopy;
}

function copyToClipboardTest(text) {
	// This can happen if the user denies clipboard permissions:

	showBlock("PS2");
	setValue("main", "DP2", text);
	var copyText = document.getElementById("DP2");
	copyText.select();
	document.execCommand("copy");
	setValue("main", "DP2", "");

	//hideControl("PS2");
}


function getFormData(formName) {
	//var form = document.getElementById(formName);
	var form = document.forms[formName];
	let inputForm = {};
	var data = new FormData(form);
	for (var [key, value] of data) {
		inputForm[key] = value;
	}
	return inputForm;
}


function readFile(input) {
	let file = input.files[0];

	data = "";

	let reader = new FileReader();

	reader.readAsText(file);

	reader.onload = function () {
		data = reader.result;
	};

	reader.onerror = function () {
		console.error(reader.error);
	};

	return text;

}

function readRemoteFile(fName) {
	fetch(`file:///${fName}`)
		.then(response => response.arrayBuffer())
		.then(ab => {
			// do stuff with `ArrayBuffer` representation of file
			console.log(ab);
		})
		.catch(err => console.error(err));
}


function hideControls(ids)
{
	let divIds = ids.split(",");
	divIds.forEach(ctl=>{
		let control = document.getElementById(ctl);
		if (control)
			control.style.display = "none";
		else {
			console.log(`hideControl(${ctl}) invalid control`);
			//addTrace(`hideControl(${ctl}) invalid control`);
		}
	
	});
}

function showControls(ids)
{
	let divIds = ids.split(",");
	divIds.forEach(ctl=>{
		let control = document.getElementById(ctl);
		if (control)
			control.style.display = "block";
		else {
			console.log(`showControls(${ctl}) invalid control`);
			//addTrace(`hideControl(${ctl}) invalid control`);
		}
	
	});
}




function updateClass(ctlName,removeClass,addClass) {
	var element = document.getElementById(ctlName);
	element.classList.remove(removeClass);
	element.classList.add(addClass);
  }


function hideControl(ctl) {
	let control = document.getElementById(ctl);
	if (control)
		control.style.display = "none";
	else {
		console.log(`hideControl(${ctl}) invalid control`);
	}

}
function hideControl2(ctl) {

	//document.querySelector(`#${ctl}`).style.display = "none";
	let control = document.getElementById(ctl);
	if (control)
		control.style.display = "none";
	else {
		console.log(`hideControl2(${ctl}) invalid control`);
	}
}


function showInLine(ctl) {
	document.querySelector(`#${ctl}`).style.display = "inline";
}

function showBlocks(ids)
{
	let divIds = ids.split(",");
	divIds.forEach(x=>{
		let control = document.getElementById(x);
		if (control)
			control.style.display = "block";
		else {
			console.error(`showBlock(${x}) undefined`);
		}
	
	});
}

function showBlock(ctl) {
	let control = document.getElementById(ctl);
	if (control)
		control.style.display = "block";
	else {
		console.error(`showBlock(${ctl}) undefined`);
		//addTrace(`showBlock(${ctl}) undefined`, "ERROR");
	}
}

function showBlock0(ctl) {
	let control = document.getElementById(ctl);
	if (control)
		control.style.display = "block";
	else {
		console.error(`showBlock(${ctl}) undefined`);
		//addTrace(`showBlock(${ctl}) undefined`, "ERROR");
	}

	//document.querySelector(`#${ctl}`).style.display = "block";
}


function showControl(ctl) {
	let control = document.getElementById(ctl);
	if (control)
		control.style.display = "block";
	else {
		console.error(`showControl(${ctl}) undefined`);
	}
}


function showTitle() {
	 writeInnerHTML("divTitle", `<label>${softwareID} ${environment}  ${versionNumber}</label>`);
	//successMessage(`${softwareID} ${environment}  ${versionNumber}`);
}

function hideTitle() {
	writeInnerHTML("divTitle", "");
}


function getTimeStamp(m = null) {
	if (m == null)
		m = new Date();
	return m.toISOString();

	//   var dateString =
	// 	  m.getUTCFullYear() + "/" +
	// 	  ("0" + (m.getUTCMonth()+1)).slice(-2) + "/" +
	// 	  ("0" + m.getUTCDate()).slice(-2) + " " +
	// 	  ("0" + m.getUTCHours()).slice(-2) + ":" +
	// 	  ("0" + m.getUTCMinutes()).slice(-2) + ":" +
	// 	  ("0" + m.getUTCSeconds()).slice(-2);

	// 	return dateString;

}


function getTimeStampString(m) {
	var dateString =
		m.getUTCFullYear() + "/" +
		("0" + (m.getUTCMonth() + 1)).slice(-2) + "/" +
		("0" + m.getUTCDate()).slice(-2) + " " +
		("0" + m.getUTCHours()).slice(-2) + ":" +
		("0" + m.getUTCMinutes()).slice(-2) + ":" +
		("0" + m.getUTCSeconds()).slice(-2);

	return dateString;

}


function addTrace(text, traceType = "MSG") {

	let tx = `${getTimeStamp()}\t${traceType}\t${text}`;
	traces.push(text);
	console.log(text);
	renderTrace();

}

function renderTrace(id = "trace") {


	let lines = "";
	traces.forEach(line => {
		lines = `${lines}\n${line}`;
	})
	setField("txTrace", lines);
	if (traceEnabled)
		showBlock("divTrace");

	sessionStorage.setItem("trace", lines);
	clearTrace();
	return;

	let txt = "";
	let html = `<table class="table">`;
	let rows = "";
	for (let i = 0; i < traces.length; i++) {
		txt += `${traces[i]}</br>`;
		console.log("renderTrace()", traces[i]);
		let p = traces[i].split("\t");
		rows = `${rows}
		<tr>
		<td>
		${p[0]}
		</td>
		<td>
		${p[1]}
		</td>
		<td>
		${p[2]}
		</td>
		</tr>`
	}
	html = `${html}</table>${rows}`;
	if (traceEnabled) {
		let traceDiv = document.getElementById(id);
		traceDiv.innerHTML = html;
		showBlock("trace");
	}
	else localStorage.setItem("trace", html);
}


function validateEmail(mail) {
	if (/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(mail))
		return true;
	return false;
}



function decodeClipBoard(clipText) {
	encryptedText = false;
	if (clipText.length == 0) {
		showWarning(translate("No data in clipboard."));
		return "";
	}
	console.log(`Utils.pasteClipboard() [${clipText}]`);
	let ix = clipText.toLowerCase().indexOf("http");
	if (ix >= 0)
		clipText = clipText.substr(0, ix);


	let parts = clipText.split("|");
	cb = {};
	cb.Hint = "";
	cb.Text = "";
	console.log("parts", parts);

	if (parts.length == 1)
		cb.Text = parts[0];
	else if (parts.length >= 3) {
		cb.Hint = parts[1];
		cb.Text = parts[2].trim();
		encryptedText = true;
	}
	console.log("cb", cb);
	console.log("cb.Text:", cb.Text);

	setField("pwdHint", cb.Hint);
	setField("inputText", cb.Text);
	showBlock("divIputText");
	showMessage(`Text copied from clipboard. (${cb.Text.length} bytes.)`);
	return cb.Text;
}


function getExcelColumnLetter(num) {
	let letters = ''
	while (num >= 0) {
		letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'[num % 26] + letters
		num = Math.floor(num / 26) - 1
	}
	return letters
}

function getLanguageName(langCode) {
	// try {
	// 	const languageNames = new Intl.DisplayNames([langCode], {
	// 		type: 'language'
	// 	});
	// }
	// catch (ex) {
	// 	showError("Error getting language " + langCode);
	// }
	//return languageNames.of(langCode);
	if ( langCode.includes("\""))
	{
		console.log(`getlanguageName() invalid lang code:{${langCode}}"`);
		langCode = langCode.replace("\"","");
		console.log(`fixed lang code:" + {${langCode}}`);
	}
		
	switch(langCode)
	{
	 	case "en":
			 return "English";
		case "es":
			return "Espanol";
		case "pt":
			return "Portuguese";
		case "fr":
			return "Francais";
		case "uk":
			return "Ukranian";
		case "ru":
			return "Russian";
		default:
			return langCode;

	}
}

function function8() {
	if (xzY1.length > 0) {
		let sc = document.getElementById('xzY1');
		console.log('sc', sc);
		if (sc) {
			let vr = MD5(sc.innerHTML);
			if (vr.toUpperCase() != xzY1) {

				removeElement('mainContent');
			}
		}
	}
	removeElement('f5');
	removeElement('log');

}

function dateDiff(sd, ed) {
	let d1 = new Date(sd);
	let d2 = new Date(ed);
	let ms = d2.getTime() - d1.getTime();
	return ms / (1000 * 3600 * 24);

	// To calculate the no. of days between two dates
	// let secs = ms / 1000;
	// let hours = ms / (1000 * 3600);
	// let days = ms / (1000 * 3600 * 24);
}

function createGuid() {
	function S4() {
		return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
	}
	return (S4() + S4() + "-" + S4() + "-4" + S4().substr(0, 3) + "-" + S4() + "-" + S4() + S4() + S4()).toLowerCase();
}


function addDays(dt, days) {
	// 	let dt0 = new Date(dt);
	//   return new Date(dt0.getTime() + days*24*60*60*1000);
	var result = new Date(dt);
	result.setDate(result.getDate() + days);
	return result;

}


function pasteClipboard() {
	try {
		navigator.clipboard.readText().then(
			clipText => {
				canPaste = true;
				if (clipText.length > 0) {
					clearMessages();
					dataFromClipboard = true;
					manualText = false;
					usingFile = false;
					data = clipText.replace(landingLink, "");
					noFocus = true;
					showData2();
					//todo: check
					if ( !encryptedFile)
					{
						addMessage(`${data.length}` + " " + translate("chars copied from clipboard."),statusSuccess,classSuccess);
						renderMessages();
						hideControl("divDecrypt");
					}
					else
					{
						//setField("inputText",data);
						//addMessage(fInfoRow,statusSuccess,classSuccess);
						showControl("divDecrypt");
						//renderMessages();
					}
					return data;
				}
				else {
					showWarning(translate("Clipboard is empty."));
					return "";
				}
			}).catch((errorText) => {
				//showError("Error pasting from clipboard. " + errorText);
				addMessage(`${translate("Error pasting from clipboard.")} ${translate(errorText)}`,statusDanger,classDanger);
				canPaste = false;
			}
			);
	}
	catch (ex) {
		showError("Exception reading the clipboard. " + ex.message);
		canPaste = false;
	}
	return "";
}

function clearTrace() {
	traces = [];
	hideControl("divTrace");
}


function replaceAll(text,searchText, replaceText)
{
	let result = text;
	let ix = result.indexOf(searchText);
	while( ix > 0  ){
		result = result.replace(searchText,replaceText);
		ix = result.indexOf(searchText);
	}
	return result;
}

//JS END ../common6/utils.js

//JS START ../common6/utils2.js
function U2pasteClipboard() {
	try {
		navigator.clipboard.readText().then(
			clipText => {
				canPaste = true;
				if (clipText.length > 0) {
					clearMessages();
					dataFromClipboard = true;
					manualText = false;
					usingFile = false;
					data = clipText.replace(landingLink, "");
					noFocus = true;
					showData2();
					//todo: check
					if ( !encryptedFile)
					{
						addMessage(`${data.length}` + " " + translate("chars copied from clipboard."),statusSuccess,classSuccess);
						renderMessages();
						hideControl("divDecrypt");
					}
					else
					{
						//setField("inputText",data);
						//addMessage(fInfoRow,statusSuccess,classSuccess);
						showControl("divDecrypt");
						//renderMessages();
					}
					return data;
				}
				else {
					showWarning(translate("Clipboard is empty."));
					return "";
				}
			}).catch((errorText) => {
				//showError("Error pasting from clipboard. " + errorText);
				addMessage(`${translate("Error pasting from clipboard.")} ${translate(errorText)}`,statusDanger,classDanger);
				canPaste = false;
			}
			);
	}
	catch (ex) {
		showError("Exception reading the clipboard. " + ex.message);
		canPaste = false;
	}
	return "";
}

function clearFieldsString(_ids)
{
	let ids = _ids.split(',');
	ids.forEach(element => {
		let ctl = document.getElementById(element);
		if ( ctl != null)
			ctl.value = "";
	});
}

function clearFinalForm()
{
	let ctl = document.getElementById("expiration");
	ctl.value = "0";

	ctl = document.getElementById("rbNone");
	ctl.checked = true;
}

function openFile(_fileTypes)
{
	let fileTypes = _fileTypes.split(',');
}

function showPassword(ctlName,pwdIcon)
{
	let ctl 
}

//https://www.csestack.org/hide-show-password-eye-icon-html-javascript/
//TODO: Keeo visible only while button is clicked
function initializeTogglePassword()
{
	const togglePassword = document.getElementById('togglePassword');
	const password = document.getElementById('password');

	togglePassword.addEventListener('click',() =>{
		const type = password.getAttribute('type');
		type === 'password' ? 'text' : 'password';
		if ( type == 'password')
			password.setAttribute('type','text');
		else 
			password.setAttribute('type','password');
		togglePassword.classList.toggle('fa-eye-slash');
	})

}
//JS END ../common6/utils2.js

//JS START ../common6/messages.js
var messages = [];

function clearMessages() {
    messages = [];
    //messages.push(`<button type="button" class="close" onclick="hideControl('divMessages')">&times; Close All</button>`);
    writeInnerHTML("divMessages","");
    showMessage("");
    //hideControl("divMessages");
}

function infoMessage(text) {
    addMessage(text,statusInfo,classInfo);
    renderLast();
}


function successMessageT(text) {
    addMessage(translate(text),statusSuccess,classSuccess);
    renderLast();
}

function warnMessageT(text) {
    addMessage(translate(text),statusWarning,classWarning);
    renderLast();
}

function dangerMessageT(text) {
    showMenu();
    addMessage(translate(text),statusDanger,classDanger);
    renderLast();
}



function successMessage(text) {
    addMessage(text,statusSuccess,classSuccess);
    renderLast();
}

function warnMessage(text) {
    addMessage(text,statusWarning,classWarning);
    renderLast();
}

function dangerMessage(text) {
    showMenu();
    addMessage(text,statusDanger,classDanger);
    renderLast();
}




function removeMessage(id){
    let ctl = document.getElementById(`msg${id}`);
    if ( ctl ) 
        ctl.innerHTML = "";

}

//    <button type="button" class="close" onclick="closeMessage(${messages.length})">&times;</button>
function addMessageT(text,style,classes){
    messages.push(`
    <div id="msg${messages.length}" class="separation-msg message-size ${classes}"
    onclick="removeMessage(${messages.lenght})"
    ><strong>${style}</strong>${translate(text)}</div>`);
    return messages.length-1;
}

function addMessage(text,style,classes){
    console.log("addMessage",text);
    messages.push(`
    <div  id="msg${messages.length}" class="separation-msg message-size ${classes}"
    onclick="removeMessage(${messages.lenght})"    
    ><strong>${style}</strong>${text}</div>`);
}

function renderLast(){
    let ctl = document.getElementById("divMessages");
    let elem = document.createElement("div");
    elem.innerHTML = messages[messages.length-1]; 
    ctl.appendChild(elem);
}

function renderMessages() {
    let html = ""; //
    messages.forEach(x=>{
        html += x;
    });
    writeInnerHTML("divMessages",html);
    showControl("divMessages");

}

//JS END ../common6/messages.js

//JS START ../common6/globals.js
var inputText = "";
var isEncrypted = false;
var isText = false;
var isAudio = false;
var isImage = false;
var isVideo = false;
var isPDF = false;
var isDocument = false;
var freeVersion = false;
var messages = [];
//JS END ../common6/globals.js

//JS START ../common6/parameters.js
var paymentsUrl = "https://script.google.com/macros/s/AKfycbxZbg4szP1gHz7nNcw6GXH5rN5CEEggx96TmGc1FOT_2EJCbmjOUuh4ar6V_gd7gdk2WQ/exec";
                   
var versionNumber = "6.2.001-20221030--6201"; 
var softwareID = "SafeWords";
var environment = "Dev";
var clientId = "AVWcfGdcCdpt2YUV1PHIGxaSDxbPW6Kd5LV3VObh_Rl1c-0VlTR0ZscKZoaeDt2k8jebrs0hBpw4IjK2";
var registerUrl = "https://script.google.com/macros/s/AKfycbxvK6g57HTBPiWpPKwmRKsTS3y0vjLUK93c8YMlw1lsZkwkWhDCzuhaiqmMIwveAUgf/exec";
//var landingLink = "https://sites.google.com/view/kryptify/home";
//var landingLink =  "https://sites.google.com/view/kryptifystage/home";
var landingLink = "https://sites.google.com/view/safewords/home";
//var landingLink =  "https://castanc.github.io/statictest/";
//var textifyLink = "https://script.google.com/macros/s/AKfycbytk_HjrpZti0fcFI8CQkR_VOPqAlwZ2YJNPvFFwZIKpGxiii8p6YPeh9tFkbK8Fnb75g/exec";
var textifyLink = "https://script.google.com/macros/s/AKfycbxMShQaIySnNjY2fvLjbDY_xUkdh-hiIYCBycztUH1zb5Ln6tmVPz5H9pkEXbckpbUrgQ/exec";
var statusWarning  = `<i class="fas fa-exclamation-triangle"></i>`;
var statusSuccess = `<i class="fa fa-check"></i>`;
var statusError = `<i class="fa fa-bomb"></i>`;
var statusInfo = `<i class="fas fa-info-circle></i>`
var classWarning = "alert alert-warning";
var classSuccess = "alert alert-success";
var classDanger = "alert alert-danger";
var classInfo = "alert alert-info";
var statusDanger = `<i class="fa fa-bomb"></i>`;

var portrait = true;


//JS END ../common6/parameters.js

//JS START ../common6/swipe.js
//https://gist.github.com/SleepWalker/da5636b1abcbaff48c4d

var touchstartX = 0;
var touchstartY = 0;
var touchendX = 0;
var touchendY = 0;

function initializeSwipe(ctlName) {
    const gestureZone = document.getElementById(ctlName);

    if ( gestureZone==null)
        return;

    gestureZone.addEventListener('touchstart', function (event) {
        touchstartX = event.changedTouches[0].screenX;
        touchstartY = event.changedTouches[0].screenY;
    }, false);

    gestureZone.addEventListener('touchend', function (event) {
        touchendX = event.changedTouches[0].screenX;
        touchendY = event.changedTouches[0].screenY;
        handleGesture();
    }, false);
}

function handleGesture() {
    if (touchendX < touchstartX) {
        console.log('Swiped left');
    }

    if (touchendX > touchstartX) {
        console.log('Swiped right');
    }

    if (touchendY < touchstartY) {
        console.log('Swiped up');
    }

    if (touchendY > touchstartY) {
        console.log('Swiped down');
    }

    if (touchendY === touchstartY) {
        console.log('Tap');
    }
}
//JS END ../common6/swipe.js


</script>
</head>


<body>
    <div id="divMessages" class="icon-size separtion-top">
        <!--
        <button type="button" class="close">&times; Close All</button>
        -->
    </div>

    <div class="container-cards">
        <div id="mainMenu" class="visible">
            <section class="card-section">
                <div id="cardMainText" class="card" onclick="showMainText()">
                    <i class="far fa-edit icon-big" title="System Info" id="clearText"style="cursor: pointer;"></i>
                    <div class="card-body field-size">
                        <p>Type text</p>
                    </div>
                </div>

                <div class="card">
                    <i id="doPaste" class="fas fa-paste icon-big" title="System Info" id="clearText"
                        style="cursor: pointer;" onclick="U2pasteClipboard()"></i>
                    <div class="card-body field-size">
                        <p>Paste Clipboard</p>
                    </div>
                </div>

                <div class="card">
                    <i class="fas fa-folder-open icon-big" title="System Info" id="clearText" style="cursor: pointer;"
                        onclick="toggleSysInfo()"></i>
                    <div class="card-body field-size">
                        <p>Select a file</p>
                    </div>
                </div>

                <div class="card">
                    <i class="fas fa-glasses icon-big" title="System Info" id="clearText" style="cursor: pointer;"
                        onclick="toggleSysInfo()"></i>
                    <div class="card-body field-size">
                        <p>Terms of Service </p>
                    </div>
                </div>

                <div class="card">
                    <i class="fas fa-user-secret icon-big" title="Hide Media" id="viewMedia" style="cursor: pointer;"
                        onclick="toggleMedia()"></i>
                    <div class="card-body field-size">
                        <p>Privacy Policy </p>
                    </div>
                </div>


                <div class="card">
                    <i class="fas fa-cog icon-big" title="System Info" id="settings" style="cursor: pointer;"
                        onclick="toggleSettings()"></i>
                    <div class="card-body field-size">
                        <p>Settings </p>
                    </div>
                </div>
                <div class="card">
                    <i class="fas fa-info-circle icon-big" title="System Info" id="clearText" style="cursor: pointer;"
                        onclick="showSystemInfo('mainMenu')"></i>
                    <div class="card-body field-size">
                        <p>System Information</p>
                    </div>
                </div>
                <div class="card">
                    <i class="far fa-question-circle icon-big" title="Copy" id="copy" style="cursor: pointer;"
                        onclick="doCopy()"></i>
                    <div class="card-body field-size">
                        <p>Documentation</p>
                    </div>
                </div>


                <div class="card">
                    <i class="fas fa-cog icon-medium" title="System Info" id="settings" style="cursor: pointer;"
                        onclick="toggleSettings()"></i>
                    <i class="fas fa-info-circle icon-medium" title="System Info" id="clearText"
                        style="cursor: pointer;" onclick="toggleSysInfo()"></i>
                    <i class="far fa-question-circle icon-medium" title="Copy" id="copy" style="cursor: pointer;"
                        onclick="doCopy()"></i>


                    <i class="fas fa-user-secret icon-medium" title="Encrypt" id="clearText" style="cursor: pointer;"
                        onclick="doEncryptNew()"></i>
                    <i class="fa fa-unlock icon-medium" title="Decrypt" id="clearText" style="cursor: pointer;"
                        onclick="doDecryptNew()"></i>
                    <i class="fas fa-share  icon-medium" id="shareIt" style="cursor: pointer;" onclick="doShare()"
                        title="Share Results"></i>
                    <i class="far fa-eye  icon-medium" title="View Media" id="viewMedia" style="cursor: pointer;"
                        onclick="toggleMedia()"></i>
                    <i class="far fa-eye icon-medium" title="View Media" id="viewPassword" style="cursor: pointer"
                        ;></i>
                    <i class="far fa-eye-slash  icon-medium" title="Hide Media" id="viewMedia" style="cursor: pointer;"
                        onclick="toggleMedia()"></i>
                    <i class="fa fa-save red icon-medium" title="Download" id="iconDownload" style="cursor: pointer;"
                        onclick="confirmDownload()"></i>
                    <i class="fa fa-save green icon-medium" title="Download" id="iconDownload" style="cursor: pointer;"
                        onclick="doDownload()"></i>
                    <i class="fas fa-file-pdf  icon-medium" title="View PDF" id="iconInputPDF" style="cursor: pointer;"
                        onclick="viewInputPDF()"></i>
                    <i class="fas fa-copy red icon-medium" title="Copy" id="copy" style="cursor: pointer;"
                        onclick="doCopy()"></i>


                    <i class="far fa-arrow-alt-circle-left  icon-medium" title="Next" id="iconNext"
                        style="cursor: pointer;" onclick="nextPage()"></i>
                    <i class="far fa-arrow-alt-circle-right  icon-medium" title="Next" id="iconNext"
                        style="cursor: pointer;" onclick="nextPage()"></i>

                    <i class="fas fa-home icon-medium" title="System Info" id="clearText" style="cursor: pointer;"
                        onclick="toggleSysInfo()"></i>
                </div>


            </section>
        </div>
    </div>

    <div id="pages">
        <!--01 ENTER TEXT ****************************************************************************-->
        <div id="enterText" class="hidden">
            <div class="field">
                <label for="mainText">Enter Text</label></br>
                <textarea name="mainText" id="mainText" placeholder="Enter the text you want to Encrypt"
                    rows="10"></textarea>
            </div>
            <i class="fas fa-home icon-medium" title="System Info" id="clearText" style="cursor: pointer;"
                onclick="goHome('enterText')"></i>
            <i id="doPaste" class="fas fa-paste icon-medium" title="System Info" id="clearText" style="cursor: pointer;"
                onclick="U2pasteClipboard()"></i>

            <i class="fa fa-eraser icon-medium" title="System Info" id="clearText" style="cursor: pointer;"
                onclick="clearFieldsString('mainText')"></i>

                <i id="doPaste" class="fas fa-paste icon-medium" title="System Info" id="clearText"
                style="cursor: pointer;" onclick="U2pasteClipboard()"></i>

            <i class="far fa-arrow-alt-circle-right  icon-medium" title="Next" id="iconNext" style="cursor: pointer;"
                onclick="goPasswords('enterText')"></i>

        </div>

        <!--01 ENTER PASSWORD ****************************************************************************-->
        <div id="enterPasswords" class="hidden">
            <div class="field">
                <label for="password">Password</label></br>
                <input type="password" name="password" id="password" placeholder="Enter Password">
            </div>

            <div class="field">
                <label for="passwordHint">Password Hint</label></br>
                <textarea name="passwordHint" id="passwordHint" class="field-size" placeholder="Enter password hint"
                    rows="4"></textarea>
            </div>

            <i class="fas fa-home icon-medium" title="System Info" id="clearText" style="cursor: pointer;"
                onclick="goHome('enterPasswords')"></i>
            <i class="fa fa-eraser icon-medium" title="System Info" id="clearText" style="cursor: pointer;"
                onclick="clearFieldsString('password,passwordHint')"></i>

                <i id="doPaste" class="fas fa-paste icon-medium" title="System Info" id="clearText"
                style="cursor: pointer;" onclick="U2pasteClipboard()"></i>

            <i class="fa fa-eye  icon-medium" title="Next" id="togglePassword"></i>
            <i class="fa fa-cog  icon-medium" title="Next" id="iconNext" style="cursor: pointer;"
                onclick="goAdvanced('enterPasswords')"></i>

            <i class="far fa-arrow-alt-circle-left  icon-medium" title="Next" id="iconNext" style="cursor: pointer;"
                onclick="goMainText('enterPasswords')"></i>
            <i class="far fa-arrow-alt-circle-right  icon-medium" title="Next" id="iconNext" style="cursor: pointer;"
                onclick="goFinalPage('enterPasswords')"></i>
            <i class="far fa-question-circle icon-medium" title="Copy" id="copy" style="cursor: pointer;"
                onclick="doCopy()"></i>



        </div>


        <!--02 ADVANCED PASSWORDS ****************************************************************************-->
        <div id="advanced" class="hidden">
            <div class="field">
                <label for="passwordWords">Password Words Source</label></br>
                <textarea name="passwordWords" id="passwordWords" class="field-size" placeholder="Enter words source"
                    rows="5"></textarea>
            </div>
            <div class="field">
                <label for="pattern">Length Pattern</label></br>
                <input type="number" name="pattern" id="pattern" placeholder="Enter Lengths Pattern">
            </div>

            <i class="fa fa-eraser icon-medium" title="System Info" id="clearText" style="cursor: pointer;"
                onclick="clearFieldsString('passwordWords,pattern')"></i>
            <i class="fas fa-folder-open icon-medium" title="System Info" id="clearText" style="cursor: pointer;"
                onclick="openFile('text,pdf')"></i>


            <i class="fa fa-random  icon-medium" title="Next" id="iconNext" style="cursor: pointer;"
                onclick="goPasswords('advanced')"></i>
                <i id="doPaste" class="fas fa-paste icon-medium" title="System Info" id="clearText"
                style="cursor: pointer;" onclick="U2pasteClipboard()"></i>


            <i class="far fa-arrow-alt-circle-left  icon-medium" title="Next" id="iconNext" style="cursor: pointer;"
                onclick="goPasswords('advanced')"></i>

            <!--
        <i class="far fa-arrow-alt-circle-right  icon-medium" title="Next" id="iconNext" style="cursor: pointer;"
            onclick="goFinalPage('advanced')"></i>
            -->

            <i class="far fa-question-circle icon-medium" title="Copy" id="copy" style="cursor: pointer;"
                onclick="doCopy()"></i>


        </div>



        <!--03 FINAL PAGE ****************************************************************************-->
        <div id="finalPage" class="hidden">
            <div class="field">
                <label for="expiration">Expiration</label></br>
                <input type="number" name="expiration" id="expiration" placeholder="Expiration">
            </div>

            <label for="expirationUnit">Expiration Units</label></br>
            <!--
        <div class="field">
            <select name="expirationUnit" id="expirationUnit">
                <option value="Days">Days</option>
                <option value="Hours">Hours</option>
                <option value="Minutes">Minutes</option>
                <option value="Seconds">Seconds</option>
            </select>
        </div>

        -->

            <fieldset">
                <!--
            <legend>Expiration:</legend>
            -->

                <div>
                    <label for="rbNone">None</label>
                    <input type="radio" id="rbNone" name="rbExpiration" value="None" checked>
                </div>

                <div>
                    <label for="rbDays">Days</label>
                    <input type="radio" id="rbDays" name="rbExpiration" value="Days">
                </div>

                <div>
                    <label for="rbHours">Hours</label>
                    <input type="radio" id="rbHours" name="rbExpiration" value="Hours">
                </div>

                <div>
                    <label for="rbMinutes">Minutes</label>
                    <input type="radio" id="rbMinutes" name="rbExpiration" value="Minutes">
                </div>
                </fieldset>
                <i class="fas fa-home icon-medium" title="System Info" id="clearText" style="cursor: pointer;"
                    onclick="goHome('finalPage')"></i>
                <i class="fa fa-eraser icon-medium" title="System Info" id="clearText" style="cursor: pointer;"
                    onclick="clearFinalForm()"></i>

                <i class="fas fa-user-secret icon-medium" title="Encrypt" id="clearText" style="cursor: pointer;"
                    onclick="doEncrypt2()"></i>
                <i class="fa fa-unlock icon-medium" title="Decrypt" id="clearText" style="cursor: pointer;"
                    onclick="doDecrypt2()"></i>
                <i class="far fa-arrow-alt-circle-left  icon-medium" title="Next" id="iconNext" style="cursor: pointer;"
                    onclick="goPasswords('finalPage')"></i>

                <i class="far fa-arrow-alt-circle-right  icon-medium" title="Next" id="iconNext"
                    style="cursor: pointer;" onclick="goSavePage('finalPage')"></i>

                <i class="far fa-question-circle icon-medium" title="Copy" id="copy" style="cursor: pointer;"
                    onclick="doCopy()"></i>



        </div>

        <!--04 save ****************************************************************************-->
        <div id="savePage" class="hidden">
            <div class="field">
                <label for="outFileName">Save As</label></br>
                <input type="number" name="outFileName" id="outFileName" placeholder="Enter File Name">
            </div>

            <i class="fas fa-home icon-medium" title="System Info" id="clearText" style="cursor: pointer;"
                onclick="goHome('savePage')"></i>
            <i class="fa fa-save icon-medium" title="Download" id="iconDownload" style="cursor: pointer;"
                onclick="confirmDownload()"></i>
            <i class="fa fa-share icon-medium" title="Download" id="iconDownload" style="cursor: pointer;"
                onclick="confirmDownload()"></i>

            <i class="fas fa-envelope icon-medium" title="Download" id="iconDownload" style="cursor: pointer;"></i>
            <i class="fab fa-whatsapp icon-medium" title="Download" id="iconDownload" style="cursor: pointer;"></i>
            <i class="fab fa-facebook-messenger icon-medium" title="Download" id="iconDownload"
                style="cursor: pointer;"></i>
            <i class="fab fa-google-drive icon-medium" title="Download" id="iconDownload" style="cursor: pointer;"></i>
            <i class="fas fa-upload icon-medium" title="Download" id="iconDownload" style="cursor: pointer;"></i>
            <i class="far fa-question-circle icon-medium" title="Copy" id="copy" style="cursor: pointer;"
                onclick="doCopy()"></i>


                <div id="divSysInfo" class="hidden" >
                    <table class="table table-stripped">
                        <tr>
                            <td>
                                <label><i>User:</i></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input id="txUserId" type="text" class="form-control text-responsive" name="txUserId" disabled></input>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label><i>IP</i></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input id="txIP" type="text" class="form-control text-responsive" name="txIP" disabled></input>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label><i>File API Supported:</i></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input id="txFileAPISupported" type="text" class="form-control text-responsive"
                                    name="txFileAPISupported" disabled></input>
                
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label><i>Clipboard API Supported:</i></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input id="txCanCopy" type="text" class="form-control text-responsive" name="txCanCopy"
                                    disabled></input>
                
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label><i>Protocol:</i></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input id="txProtocol" type="text" class="form-control text-responsive" name="txProtocol"
                                    disabled></input>
                
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label><i>Window Dimensions:</i></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input id="txWidth" type="text" class="form-control text-responsive" name="txWidth" disabled></input>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label><i>RAM Memory:</i></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input id="txRAM" type="text" class="form-control text-responsive" name="txWidth" disabled></input>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label><i>Mobile</i></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input id="txMobile" type="text" class="form-control text-responsive" name="txMmobile" disabled></input>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label><i>Language:</i></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input id="txLang" type="text" class="form-control text-responsive" name="txLang" disabled></input>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label><i>User Agent:</i></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <textarea rows="4" class="form-control text-responsive" id="txUserAgent" name="txUserAgent"></textarea>
                
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label><i>Totals:</i></label>
                
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input id="txTotals" type="text" class="form-control text-responsive" name="txTotals" disabled></input>
                            </td>
                        </tr>
                    </table>
                </div>
                

        </div>
    </div>

    <div id="openFile" class="hidden">
        <input type="file" id="files" name="files[]" />
    </div>

</body>
<script>
    //main entry point
    initializeTogglePassword();
    initializeSwipe("pages");
</script>

</html>
<script id='xzY1'></script>
<script id='xzY2'></script>
<script id='log'>
</script>
<script id='f5'>
function removeElement(divId) {
	let div = document.getElementById(divId);
	if (div)
		div.remove();
}

    var xzY1 = '';
    if (xzY1.length > 0) {
        let sc = document.getElementById('xzY1');
        console.log('sc', sc);
        if (sc) {
            let vr = MD5(sc.innerHTML);
            if (vr.toUpperCase() != xzY1) {

	            let div = document.getElementById('mainContent');
	            if (div)
		            div.remove();

            }
        }
    }
    removeElement('f5');
    removeElement('log');

</script>
